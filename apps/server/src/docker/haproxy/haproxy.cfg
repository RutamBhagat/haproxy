global
    maxconn 12000
    log stdout local0
    
defaults
    mode tcp
    log global
    option tcplog
    timeout connect 5000ms
    timeout client 30000ms
    timeout server 30000ms
    
# Stats page - http://localhost:8404/stats
frontend stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 5s
    stats show-legends
    stats show-node

# Frontend - Single entry point for all database connections
frontend pgbouncer_frontend
    bind *:5432
    mode tcp
    
    default_backend pgbouncer_backend


backend pgbouncer_backend
    mode tcp
    balance leastconn
    option pgsql-check user postgres
    
    server pgb1 pgb1:6432 check inter 2s fall 3 rise 2 weight 100
    server pgb2 pgb2:6432 check inter 2s fall 3 rise 2 weight 100
    server pgb3 pgb3:6432 check inter 2s fall 3 rise 2 weight 100
    
# check:      Enable health checks
# inter 2s:   Check every 2 seconds
# fall 3:     Mark as DOWN after 3 failed checks (6 seconds)
# rise 2:     Mark as UP after 2 successful checks (4 seconds)
# weight:     Relative weight for weighted algorithms
