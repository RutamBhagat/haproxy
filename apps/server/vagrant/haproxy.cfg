global
    maxconn 12000
    log stdout local0
    
defaults
    mode tcp
    log global
    option tcplog
    timeout connect 5000ms
    timeout client 30000ms
    timeout server 30000ms
    
# Stats page - http://192.168.1.100:8404/stats
frontend stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 5s
    stats show-legends
    stats show-node

# Frontend - PostgreSQL connections through VIP
frontend pgbouncer_frontend
    bind *:5432
    mode tcp
    default_backend pgbouncer_backend

# Backend - PgBouncer instances on host machine
backend pgbouncer_backend
    mode tcp
    balance leastconn
    option pgsql-check user postgres
    
    # 192.168.1.5 is the host machine from Vagrant VM perspective on bridged network
    server pgb1 192.168.1.5:6432 check inter 2s fall 3 rise 2 weight 100
    server pgb2 192.168.1.5:6433 check inter 2s fall 3 rise 2 weight 100
    server pgb3 192.168.1.5:6434 check inter 2s fall 3 rise 2 weight 100
